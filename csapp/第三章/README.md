## 第三章 程序的机器级表示

#### 3.2.1 机器级代码

* 程序计数器(通常称为"PC",在x86-64中用%rip表示)给出将要执行的下一条指令在内存中的地址.
* 整数寄存器文件中包括16个命名的位置,分别存储64位的值.这些寄存器可以存储地址或整数数据
* 一组向量寄存器可以存放一个或多个整数或浮点数值

程序内存包含:程序的可执行机器代码,操作系统需要的一些信息,用来管理过程调用和返回的运行时栈,以及用户分配的内存块(比如说用malloc库函数分配的)



#### 3.4.1 操作数指示符

大多数指令有一个或多个操作数,指示出执行一个操作中要使用的源数据值,以及放置结果的目的位置.

各种不同的操作数的可能性被分为三种类型:

1. 立即值, 用来表示常数, 用$开头.可以直接写整数,汇编器会将其编译成对应的二进制格式.
2. 寄存器, 即寄存器的名称, 代表某个寄存器内部的值.
3. 内存引用, 代表某个内存地址的值, 也就是寻址或者说是取地址运算, 用括号包起来一个值, 这个值可以是常量, 取得的值或者是计算所得.

寻址的模式,最常用的形式是 

`计算出的内存地址 = 立即数偏移量 + Rb + Ri * s`



##### 练习题3.1

|      地址      |  值  |
| :------------: | :--: |
| 内存地址 0x100 | 0xFF |
| 内存地址 0x104 | 0xAB |
| 内存地址 0x108 | 0x13 |
| 内存地址 0x10C | 0x11 |

| 寄存器 |  值   |
| :----: | :---: |
|  %rax  | 0x100 |
|  %rcx  |  0x1  |
|  %rdx  |  0x3  |



|     操作数      |                              值                              |
| :-------------: | :----------------------------------------------------------: |
|      %rax       |                            0x100                             |
|      0x104      |                  表示寻绝对地址,结果是0xAB                   |
|     $0x108      |                          常量 0x108                          |
|     (%rax)      |        将%rax寄存器中的0x100当做地址寻址,结果是 0xFF         |
|     4(%rax)     | 表示基址+偏移量地址,为 %rax中的 0x100地址加0x4,即 0x104地址,结果为0xAB |
|  9(%rax, %rdx)  |    表示变址寻址, 为 9+ 0x100 + 0x3 = 0x10C, 所以值是0x11     |
| 260(%rcx, %rdx) |           同理地址是 260 + 1 + 3 = 0x108, 值是0x13           |
|  0xFC(,%rcx,4)  |       比例变址寻址,结果是 0xFC + 4 = 0x100, 值是 0xFF        |
| (%rax, %rdx, 4) |  带s的变址寻址,计算后的内存是 0x100 + 4*3 = 0x10C,值是0x11   |

